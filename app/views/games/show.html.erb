<div style="background-image "id="home-bg">
</div>

<p>
  <%= @game.content %>
</p>

<% url = @game.embed_link %>

 <div class="container game-container" data-controller="game">
    <div class="game-box">
      <iframe class="game-frame" sandbox="allow-scripts allow-same-origin allow-forms" width="700" height="700" frameborder="0" src="<%= url %>"></iframe>
    </div>
    <button data-action="click->game#getScore">Score</button>
  </div>

<div id="score-display" style="margin-top 20px;">Score: 0</div>

<script>
  window.addEventListener("message", function(event) {
    // Optional: limit to same origin
    if (event.origin !== window.location.origin) return;

    if (event.data.type === "score") {
      document.getElementById("score-display").textContent = "Score: " + event.data.value;
    }
  });
</script>

<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#performanceModal">
  Submit Game Performance
</button>

<div class="modal fade" id="performanceModal" tabindex="-1" aria-labelledby="performanceModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content rounded-2xl shadow-lg">
      <div class="modal-header">
        <h5 class="modal-title text-xl font-bold" id="performanceModalLabel">Record Performance</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="form-wrapper">
          <%= simple_form_for([@target, @performance]) do |f| %>
            <%= f.hidden_field :game_id, value: @game.id %>

            <div class="mb-3">
              <%= f.input :description, label: "Game Description", input_html: { class: "form-control" } %>
            </div>

            <div class="mb-3">
              <%= f.input :accuracy, label: "Accuracy (%)", input_html: { class: "form-control" } %>
            </div>

            <div class="mb-3">
              <%= f.input :time, label: "Time Spent (minutes)", input_html: { class: "form-control" } %>
            </div>

            <div class="mb-3">
              <%= f.input :completed, as: :boolean, label: "Completed?", input_html: { class: "form-check-input" } %>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <%= f.button :submit, "Submit Performance", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
