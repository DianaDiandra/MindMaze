<div id="home-bg"></div><div class="container py-5" style="min-height: 100vh;">

  <!-- Game title and description -->
  <div class="text-center mb-4">
    <h1 class="my-font text-4xl font-bold mb-4">Play <%= @game.name %></h1>

    <div class="game-description-box mt-4">
      <p><%= simple_format(@game.content) %></p>
    </div>
  </div>

  <!-- Game area -->
  <% if @game.embed_link.present? && @game.embed_link.include?("cognifit") %>
    <div class="text-center">
      <div id="cogniFitContent" class="mx-auto" style="height: 600px;"></div>
      <button id="launch-game-button" class="btn btn-primary mt-4">Launch Game</button>
    </div>

    <script src="https://js.cognifit.com/2025-05-30_1011_witchking/html5Loader.js"></script>
    <script>
      document.getElementById("launch-game-button").addEventListener("click", function () {
        html5Loader.launchGame("<%= @game.embed_link %>", "cogniFitContent");
      });
    </script>

  <% elsif @game.embed_link.present? %>
    <div class="d-flex justify-content-center mt-4">
      <iframe class="game-frame" id="game-frame" sandbox="allow-scripts allow-same-origin allow-forms"
              width="700" height="700" frameborder="0" src="<%= @game.embed_link %>"></iframe>
    </div>
  <% else %>
    <p class="text-danger">No playable version available for this game.</p>
  <% end %>

  <!-- Button -->
  <div class="text-center mt-4">
    <button type="button" class="form-submit-button2 w-100" data-bs-toggle="modal" data-bs-target="#performanceModal">
      Submit Game Performance
    </button>
  </div>

</div> <!-- END of main container -->


<!-- Modal (outside main container!) -->
<div class="modal fade" id="performanceModal" tabindex="-1" aria-labelledby="performanceModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content rounded-2xl shadow-lg">
      <div class="modal-header">
        <h5 class="modal-title text-xl font-bold" id="performanceModalLabel">Record Performance</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="form-container" data-controller="game">
          <%= render "performances/form", target: @target, performance: @performance, game: @game %>
        </div>
      </div>
    </div>
  </div>
</div>
